# WebGL Fundamentals 读后感

> Author：moustache(huzi)<br>
>
> Date：18-9-10

## 基本概念

### 着色器

WebGL每次绘制需要两个着色器：

- 顶点着色器：生成顶点，然后进行光栅化。顶点变量关键字为gl_Position。
- 片段着色器：为当前光栅化的像素填充颜色。颜色变量关键字为gl_FragColor。

## 三维

### 深度缓冲（Z-Buffer）

深度缓冲是一个存储像素深度的矩形。基于Z值，转换到深度空间(0, 1)。

WebGL在每绘制一个像素的时候，先检查对应的深度像素，小于当前像素的深度值时，就不会上色。

开启方法：

~~~js
gl.enable(gl.DEPTH_TEST);
~~~

### 正射投影和透视投影

正射投影仅仅是把三维物体投放在二维上，透视投影还具备近大远小的效果。

通过x = x/w，y = y/w实现透视投影。

### lookAt矩阵

通过相乘一个矩阵，可以将某个点映射到相机的视锥中。

矩阵如下：

![](photo/lookAt矩阵.png)

## 光照

### 光源

- 方向光源

~~~js
dot(法向量, 光源方向) * gl_FragColor.rgb
~~~

- 点光源

~~~js
dot(法向量, (光源位置 - 接触点位置)) * gl_FragColor.rgb
~~~

- 镜面高光

~~~js
dot(法向量, (光源位置 - 接触点位置) + (相机位置 - 接触点位置)) + gl_FragColor.rgb
~~~

PS：一般求幂防止亮瞎。

### GLSL判断（子龙说不是，客观看待）

尽量不要在着色器中使用判断语句，因为着色器中的条件语句不是真的条件语句，而是使用乘法运算来实现，因此最好不要使用判断语句。而使用下面两个GLSL函数替代：

~~~js
step(a, b)
// return b >= a;

smoothstep(a, b, value)
// 如果 x <= a 返回 0.0，如果 x >= b 返回 1.0， 当 a < x < b 使用 Hermite 插值到 0 到 1 之间。
// PS: Hermite差值不是线性插值。
~~~

## 组织和重构

### 索引(indices)

索引的作用是绘制多边形时，指定绘制的顺序，三个一组。

例如：indices = [0, 1, 2, 1, 2, 3] 意为绘制一个矩形，两个三角形的绘制方向分别是 0 -> 1 -> 2 和 1 -> 2 -> 3。



